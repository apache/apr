#!/bin/sh

#
# Build aclocal.m4 from libtool's libtool.m4 and our own M4 files.
#
ltpath=`helpers/PrintPath libtoolize`
ltpath=`dirname $ltpath`
ltfile=`cd $ltpath/../share/aclocal ; pwd`/libtool.m4
echo "Incorporating $ltfile into aclocal.m4 ..."
echo "dnl THIS FILE IS AUTOMATICALLY GENERATED BY buildconf" > aclocal.m4
echo "dnl edits here will be lost" >> aclocal.m4
cat helpers/apr-conf.m4 apr_common.m4 hints.m4 $ltfile >> aclocal.m4

#
# Create the libtool helper files
#
# Note: we copy (rather than link) them to simplify distribution.
# Note: APR supplies its own config.guess and config.sub -- we do not
#       rely on libtool's versions
#
echo "Copying libtool helper files ..."
$ltpath/libtoolize --copy

#
# Generate the autoconf header and ./configure
#
echo "Creating include/arch/unix/apr_private.h.in ..."
autoheader

echo "Creating configure ..."
### do some work to toss config.cache?
autoconf

(cd shmem/unix/mm && autoconf)
